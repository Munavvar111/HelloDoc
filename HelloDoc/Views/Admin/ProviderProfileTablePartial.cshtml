<div class="table-responsive mt-4 mb-4 d-">
    <table class="table table-hover d-md-table d-none" style="vertical-align:middle">
        <thead class="table-light">
            <tr>
                <th scope="col">Stop Notification</th>
                <th scope="col">Provider Name <i class="bi bi-arrow-up"></i></th>
                <th scope="col">Role</th>
                <th scope="col">On Call Status</th>
                <th scope="col">Status</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td scope="row">
                        <input type="checkbox" class="form-check-input" name="fileIds" @(item.OnCallStaus[0] ? "checked" : "") data-physician-id="@item.physicianid">
                    </td>
                    <td scope="row">@item.Name</td>
                    <td scope="row">@item.Role</td>
                    @if (item.OnCallStaus[0])
                    {
                    <td scope="row">Available</td>
                    }
                    else{
                    
                    <td scope="row">UnAvailable</td>
                    }
                    <td scope="row">
                        @if (item.status == 1)
                        {
                            <span class="badge bg-success">Active</span>
                        }
                        else if (item.status == 2)
                        {
                            <span class="badge bg-warning text-dark">Pending</span>
                        }
                        else if (item.status == 3)
                        {
                            <span class="badge bg-secondary">Conclude</span>
                        }
                        else
                        {
                            <span class="badge bg-danger">Unknown</span>
                        }
                    </td>
                    <td scope="row">
                        <div class="d-flex">
                            <a class="btn btn-outline-info rounded me-2" data-bs-toggle="modal" data-bs-target="#contactProviderModal" data-bs-providerId="@item.physicianid">Contact</a>
                                <a asp-action="PhysicanProfile" asp-route-id="@item.physicianid" class="btn btn-outline-info rounded">Edit</a>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
    <button id="saveButton" class="btn btn-primary mt-3" style="display: none;" >Save</button>

</div>
<partial name="contactProviderModal"></partial>

@{
    var Count = 0;
}
@foreach (var items in Model)
{
    <div class="bg-info-subtle border-4 border-top d-md-none" data-bs-toggle="collapse" data-bs-target="#collapseExample-@Count" aria-expanded="false"
         aria-controls="collapseExample">
        <div class="d-flex flex-column gap-3">
            <div class="form-check mt-2 ms-3">
                <input type="checkbox" class="form-check-input px-2 py-2" @(items.OnCallStaus[0] ? "checked" : "") data-physicianMo-id="@items.physicianid">
                <label class="form-check-label" for="flexCheckDefault">
                    @items.Name
                </label>
            </div>
            <div class="mb-2 ms-3">
                <span class="text-muted">On Call Status:</span><span class="ms-1">Unavailable</span>
            </div>
        </div>
    </div>
    <div class="collapse border-2 border-top d-md-none rounded-3 bg-info-subtle " id="collapseExample-@Count">
        <div class="d-flex flex-column">
            <div class="ms-3 mt-2">
                <span class="text-muted"><i class="bi bi-person-circle text-info me-2"></i>Role: @items.Role</span>
            </div>
            <div class="ms-3">
                <span class="text-muted">
                    <i class="bi bi-check-circle text-info me-2"></i>Status:
                    @if (items.status == 1)
                    {
                        <span>Active</span>
                    }
                    else if (items.status == 2)
                    {
                        <span>Pending</span>
                    }
                    else if (items.status == 3)
                    {
                        <span>Conclude</span>
                    }
                    else
                    {
                        <span>Unknown</span>
                    }
                </span>
            </div>
            <div class="d-flex justify-content-end mb-2 gap-2">
                <a class="btn btn-outline-info rounded me-2" data-bs-toggle="modal" data-bs-target="#contactProviderModal" data-bs-providerid="@items.physicianid">
                    Contact
                <small>Contact</small>
                </a>
                <a asp-action="PhysicanProfile" asp-route-id="@items.physicianid" class="btn btn-outline-info rounded">
                <small>
                        Edit
                    </small>
                </a>
            </div>
        </div>
    </div>
    Count++;
}
<script>
    var initialCheckboxState = Array.from(document.querySelectorAll('input[type="checkbox"]')).map(function (checkbox) {
        return checkbox.checked;
    });
    var checkboxStates = [];
    var physicianIds = [];

    // Function to handle checkbox change event
    function handleCheckboxChange() {
        var currentCheckboxState = Array.from(document.querySelectorAll('input[type="checkbox"]')).map(function (checkbox) {
            return checkbox.checked;
        });
        if ($('.d-none.d-md-table').is(':visible')) {

            var checkedCheckboxes = document.querySelectorAll('.d-none.d-md-table input[type="checkbox"]:checked');
            checkboxStates = Array.from(checkedCheckboxes).map(function (checkbox) {
                return checkbox.checked;
            });
        } else {

            var checkedCheckboxes = document.querySelectorAll('.d-md-none input[type="checkbox"]:checked');
            checkboxStates = Array.from(checkedCheckboxes).map(function (checkbox) {
                return checkbox.checked;
            });
        }
        if ($('.d-none.d-md-table').is(':visible')) {
            physicianIds = Array.from(checkedCheckboxes).map(function (checkbox) {
                return checkbox.getAttribute('data-physician-id');
            });
        }
        else{
            physicianIds = Array.from(checkedCheckboxes).map(function (checkbox) {
                return checkbox.getAttribute('data-physicianMo-id');
            });
        }
        var saveButton = document.getElementById('saveButton');

        if (JSON.stringify(currentCheckboxState) !== JSON.stringify(initialCheckboxState)) {
            saveButton.style.display = 'inline-block';
        } else {
            saveButton.style.display = 'none';
        }
    }

    // Add event listeners to checkboxes
    var checkboxes = document.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener('change', handleCheckboxChange);
    });

    // Check if all checkboxes are initially unchecked
    if (initialCheckboxState.every(function (state) { return !state; })) {
        var saveButton = document.getElementById('saveButton');
        saveButton.style.display = 'none';
    }

    // Function to handle the 'Save' button click
    function saveChanges() {
        console.log('Saving changes...', { checkboxStates, physicianIds });

        debugger
        // Add the logic for saving the checkbox states and physician IDs here
        $.ajax({
            type: 'POST',
            url: '/Admin/SaveNotification',
            data: {
                physicianIds: physicianIds,
                checkboxStates: checkboxStates
            },
            success: function (response) {
                console.log('Save successful, response:', response);

                window.location.reload();
            },
            error: function (error) {
                console.error('Save failed:', error);
            }
        });
        // After saving the changes, reset the state and dismiss the save button

    }

    // Add event listener to the 'Save' button
    var saveButton = document.getElementById('saveButton');
    saveButton.addEventListener('click', saveChanges);
</script>

<script>
    $(document).ready(function () {
        $('#contactProviderModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            console.log(button)
            var recipient = button.data('bs-providerid');
            console.log(recipient);

            var modal = $(this);
            modal.find('#providerContact').val(recipient);

        });
        $('#contactProviderModal').on('hidden.bs.modal', function () {
            console.log("hidden")
            

        });


    });


</script>
