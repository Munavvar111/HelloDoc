
@{
    ViewData["Title"] = "Scheduling";
    Layout = "~/Views/Shared/_Layout4.cshtml";
}
<style>
    .fc-daygrid-event {
        cursor: pointer;
    }

    .fc-header-toolbar.fc-header-resources-only {
        background-color: #ff9999;
        border: none;
    }

    .fc-header-toolbar,
    .fc-daygrid-event {
        background-color: #CCCCCC !important; /* or any other color code */
    }

    
    .fc-timeline-header-row {
        background-color:gray!important;
    }
    .btn22 {
        padding: 0.25rem 0.5rem !important;
    }

    .fc-header-toolbar .fc-button {
        padding: 0.25rem 0.5rem !important;
    }

    .input-group {
        width: 300px;
    }

    #calendar {
        margin-top: 2rem;
    }
</style>
<div class="container-fluid">
    <div class="row justify-content-center  w-100 ">
        <div class="col-lg-7 col-md-10 col-sm-10 col-xs-12">
            <div class="pt-2 d-flex justify-content-between align-items-center">
                <h4 class="m-0">Scheduling</h4>
                <a class="btn btn-outline-info rounded-2 px-3" onclick="Provider()">
                    <i class="bi bi-chevron-left"></i> Back
                </a>
            </div>
            <div class="container d-flex flex-column  shadow">
                <div class="row mb-0 py-2 pe-2 rounded-3">
                    <div class="d-lg-flex  justify-content-between pe-1 pt-3">
                        <div class="col-xl-3  col-lg-3 col-md-12 col-sm-12 col-xs-12 col-12">
                            <select class="form-select" aria-label="Default select example" id="regionselect">
                                <option selected value="0">All Regions</option>
                                <option value="1">One</option>
                                <option value="2">Two</option>
                                <option value="3">Three</option>
                            </select>
                        </div>
                        <div class="mt-3">
                            <button type="button" class="btn btn-info rounded-2 p-2 ">Provider On Call</button>
                            <button type="button" class="btn btn-info rounded-2 p-2 ">Shift For Review</button>
                            <button data-bs-toggle="modal" data-bs-target="#createShiftModal" type="button" class="btn btn-info mx-1 btn-sm btn22  ">
                                Add New Shift
                            </button>
                        
                    </div>
                    </div>
                </div>

                <div class="row my-2">
                    <div class="col-md-7 mt-2">
                        <div id="calendarTitle" class="calendar-current-date fs-4 fw-bolder"></div>
                        <div class="text-start my-3 calendar-navigation">
                            <span id="calendar-prev" class="btn btn-info text-white rounded-circle" onclick="calendar.prev()">❮</span>
                            <span class="mx-1"><i class="bi bi-calendar-day-fill fs-3"></i></span>
                            <span id="calendar-next" class="btn btn-info text-white rounded-circle" onclick="calendar.next()">❯</span>
                        </div>
                    </div>
                    <div class="col-md-5 mt-3">
                        <div class="d-flex justify-content-end">
                            <div class="alert   mx-1 px-4" role="alert" style="background-color:#F4CAED">
                            </div>
                            <span class="mx-1">Panding Shifts</span>
                            <!-- Button trigger modal -->
                            <div class="alert alert-success mx-1 px-4" role="alert">
                            </div>
                            <span class="mx-1">Appoved Shifts</span>

                        </div>
                        <div class="d-flex justify-content-end">
                            <div id="day" class="btn btn-outline-info  mx-2" onclick="calendar.changeView('resourceTimeline')">
                                Day
                            </div>
                            <!-- Button trigger modal -->
                            <div id="week" class="btn btn-outline-info mx-2" onclick="calendar.changeView('resourceTimelineWeek')">
                                Week
                            </div>
                            <div id="month" class="btn btn-outline-info mx-2" onclick="calendar.changeView('dayGridMonth')">
                                Month
                            </div>
                        </div>
                    </div>
                </div>
                <div id="calendar" style="min-height:38vh">
                </div>
            </div>
        </div>
    </div>

</div>
<div id="case2">
</div>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.11/index.global.min.js"></script>
<script>
    var calendar;
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var selectedRegion = $('#regionselect').val();
        console.log(selectedRegion)
        getPhysicianShift(selectedRegion);

        function getPhysicianShift(region) {
            fetch('/Admin/GetPhysicianShift?region=' + region)
                .then(response => response.json())
                .then(data => {
                    const resources = data.map(physician => ({
                        id: physician.physicianid,
                        title: physician.firstname,
                        avatar: `<img src="/physician/${physician.physicianid}/photo.png" class="avatar" />`
                    }));
                    
                    // Fetch events from the server
                    fetch('/Admin/GetEvents')
                        .then(response => response.json())
                        .then(data => {
                            const events = data.map(event => ({
                                id: event.id,
                                resourceId: event.resourceId,
                                title: event.title,
                                start: event.start,
                                end: event.end,
                                eventBackgroundColor: '#e39de8',
                                color: '#e39de8'

                            }));

                            initializeCalendar(resources, events);
                        })
                        .catch(error => console.error(error));
                })
                .catch(error => console.error(error));
        }
        function initializeCalendar(resources, events) {
            $('#regionselect').on('change', function () {
                const newRegion = $(this).val();
                getPhysicianShift(newRegion);
            });
            console.log(resources)
            calendar = new FullCalendar.Calendar(calendarEl, {
                height: 'auto',
                schedulerLicenseKey: 'GPL-My-Project-Is-Open-Source',
                themeSystem: 'bootstrap5',
                headerToolbar: false,
                initialView: 'resourceTimelineDay',
                views: {
                    resourceTimelineDay: {
                        buttonText: 'Day',
                    },
                    resourceTimelineWeek: {
                        buttonText: 'Week'
                    },
                    resourceTimelineMonth: {
                        buttonText: 'Month'
                    }
                },
                datesSet: function (info) {
                    var title = info.view.title;
                    $("#calendarTitle").html(title);
                },
                resources: resources,
                events: events,
                eventClick: function (info) {
                    console.log('Event clicked:', info.event);
                },
                eventBackgroundColor: function (event) {
                    return event.eventBackgroundColor;
                },
                resourceLabelDidMount: function (resourceObj) {
                    const img = document.createElement('img');
                    const imgUrl = resourceObj.resource.extendedProps.imageUrl || `/Physician/${resourceObj.el.dataset.resourceId}/photo.png`;
                    img.src = imgUrl;
                    console.log(imgUrl);
                    img.style.maxHeight = '40px';
                    resourceObj.el.querySelector('.fc-datagrid-cell-main').appendChild(img);
                },
                dateClick: function (info) {
                    var resourceid = info.resource.id;
                    console.log(resourceid)
                },
                
            });

            $("#next-button").click(function () {
                calendar.next();
            });

            $("#prev-button").click(function () {
                calendar.prev();
            });

            $("#day-button").click(function () {
                calendar.changeView('resourceTimelineDay');
            });

            $("#week-button").click(function () {
                calendar.changeView('resourceTimelineWeek');
            });

            $("#month-button").click(function () {
                calendar.changeView('dayGridMonth');
            });

            calendar.render();
        }
    });
</script>


<partial name="CreateShiftPartial"></partial>