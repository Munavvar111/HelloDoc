@{
    ViewData["Title"] = "Scheduling";
    Layout = "~/Views/Shared/_Layout4.cshtml";
}
<style>
    .fc-daygrid-event {
        cursor: pointer;
    }

    .btn22 {
        padding: 0.25rem 0.5rem !important;
    }

    .fc-header-toolbar .fc-button {
        padding: 0.25rem 0.5rem !important;
    }

    .input-group {
        width: 300px;
    }

    #calendar {
        margin-top: 2rem;
    }
</style>
<div class="container ">
    <div class="  d-flex p-4  ">
        <h4 class="mx-2 mb-4">Scheduling</h4>
        <div class="ms-auto mt-0 ">
            <a href="javascript: history.go(-1)" type="button" class="btn btn-info mx-2  ">
                < Back
            </a>
        </div>

    </div>

    <div class="d-flex justify-content-between">
        <div class="w-25">
            <div class="input-group border  rounded-0 mb-2 form-control col-md-4 col-12">
                <div class="input-group-append">
                    <button class="btn text-secondary border border-0 bg-white" type="button">
                        <i class="bi bi-search"></i>
                    </button>
                </div>
                <input type="search" class="form-control border-0  shadow-none" placeholder="Search Regions"
                       list="data" id="myInput2" onkeyup="searchRegion()">
                <datalist class=" border-0  shadow-none" aria-label="Default select example" id="data">
                    <option value="mumbai"></option>
                    <option value="kolkata"></option>
                    <option value="banglore"></option>
                </datalist>
            </div>
        </div>
        <div class="d-flex justify-content-end">
            <div class=" ms-auto d-flex">
                <div class="col-auto">
                    <button data-bs-toggle="modal" data-bs-target="#createShiftModal" type="button"
                            class="btn btn-info ">
                        Add New Shift
                    </button>
                </div>
                <div class="col-auto">
                    <a href="Req_shift.html" type="button" class="btn btn-info mx-2 flex-wrap btn22  ">
                        Shifts For Review
                    </a>
                </div>
                <div class="col-auto">
                    <a href="providers_oncall.html" type="button"
                       class="btn btn-info mx-2 flex-wrap btn22 ">
                        Providers On call
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div id="datepicker" class="datepicker"></div>
</div>
<div class="container d-flex justify-content-between">
    <div class="d-flex">

    <button class="btn btn-primary m-1" id="prev-button"><</button>
    <h2 id="calendarTitle">Calendar</h2>
    <button class="btn btn-primary m-1" id="next-button">></button>
    </div>
    <div>

    <button class="btn btn-primary m-1" id="day-button">Day</button>
    <button class="btn btn-primary m-1" id="week-button">Week</button>
    <button class="btn btn-primary m-1" id="month-button">Month</button>
    </div>
</div>
<div id="calendar" class="container"></div>


<script src="https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.11/index.global.min.js"></script>
<script>
    var calendar;
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');

        fetch('/Admin/GetPhysicianShift')
            .then(response => response.json())
            .then(data => {
                const resources = data.map(physician => ({
                    id: physician.physicianid,
                    title: physician.firstname,
                    avatar: `<img src="/physician/${physician.physicianid}/photo.png" class="avatar" />`
                }));

                // Fetch events from the server
                fetch('/Admin/GetEvents')
                    .then(response => response.json())
                    .then(data => {
                        const events = data.map(event => ({
                            id: event.id,
                            resourceId: event.resourceId,
                            title: event.title,
                            start: event.start,
                            end: event.end
                        }));

                        initializeCalendar(resources, events);
                    })
                    .catch(error => console.error(error));
            })
            .catch(error => console.error(error));

        function initializeCalendar(resources, events) {
            console.log(resources)
            calendar = new FullCalendar.Calendar(calendarEl, {
                height: 'auto',
                schedulerLicenseKey: 'GPL-My-Project-Is-Open-Source',
                themeSystem: 'bootstrap5',
                headerToolbar: false,
                initialView: 'resourceTimelineDay',
                views: {
                    resourceTimelineDay: {
                        buttonText: 'Day',
                    },
                    resourceTimelineWeek: {
                        buttonText: 'Week'
                    },
                    resourceTimelineMonth: {
                        buttonText: 'Month'
                    }
                },
                datesSet: function (info) {
                    var title = info.view.title;
                    $("#calendarTitle").html(title);
                },
                resources: resources,
                events: events,
                eventClick: function (info) {
                    console.log('Event clicked:', info.event);
                },
                dateClick: function (info) {
                    var resourceid = info.resource.id;
                    console.log(resourceid)
                },
                
            });

            $("#next-button").click(function () {
                calendar.next();
            });

            $("#prev-button").click(function () {
                calendar.prev();
            });

            $("#day-button").click(function () {
                calendar.changeView('resourceTimelineDay');
            });

            $("#week-button").click(function () {
                calendar.changeView('resourceTimelineWeek');
            });

            $("#month-button").click(function () {
                calendar.changeView('resourceTimelineMonth');
            });

            calendar.render();
        }
    });
</script>


<partial name="CreateShiftPartial"></partial>