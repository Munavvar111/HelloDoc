@{
    ViewData["Title"] = "UserAccess";
    Layout = "~/Views/Shared/_Layout4.cshtml";
}

<div class="container bg-light mt-4">
    <div class="d-flex justify-content-between my-3">
        <div class="d-flex">
            <span class="fs-2 text-muted fw-bold">User Access</span>
        </div>
        <div class="d-flex justify-content-end">
            <a asp-controller="Admin" asp-action="Index" asp-area=""
               class="btn btn-outline-info d-flex align-items-center">
                <span class="material-symbols-outlined"> chevron_left </span> Back
            </a>
        </div>
    </div>
</div>
<div class="container bg-white border shadow-lg">
    <div class="d-flex justify-content-between">

    <div class="form-floating mb-4 mt-4 w-25">

        <select class="form-select" aria-label="Default select example" id="accounttypeuser" name="accounttypeuser">
            <option value="0">All</option>
            <option value="1">Admin</option>
            <option value="2">Physician</option>
        </select>
        <label id="floatingInput">Account</label>

    </div>
    <div id="additionalButtons" class="mb-4 mt-4"></div>

    </div>
    <div id="UserAccessPartial"></div>
</div>
<script>
    $(document).ready(function () {
        // Function to handle change in account type
        
    });
</script>
<script>
    $(document).ready(function () {
        FetchUsers();

        function handleAccountTypeChange() {
            var accountType = $("#accounttypeuser").val();
            var buttonContainer = $("#additionalButtons");
            
            // Clear previous content
            buttonContainer.empty();

            // Create and append appropriate button based on selected account type
            if (accountType === "1") {
                var createAdminAnchor = $("<a>").text("Create Admin").addClass("btn btn-outline-info");
                createAdminAnchor.attr("href", "/Admin/CreateAdmin"); // Add your ASP.NET route here
                buttonContainer.append(createAdminAnchor);
            } else if (accountType === "2") {
                var createProviderAnchor = $("<a>").text("Create Provider").addClass("btn btn-outline-info");
                createProviderAnchor.attr("href", "/Admin/CreateProvider"); // Add your ASP.NET route here
                buttonContainer.append(createProviderAnchor);
            }
        }

        // Attach event listener to account type select element
        $("#accounttypeuser").on("change", handleAccountTypeChange);

        // Trigger initial handling to show appropriate button on page load
        handleAccountTypeChange();
    });
    $("#accounttypeuser").on("change", function () {
        console.log("fii")
        FetchUsers();
    });
    function FetchUsers() {
        var role = $("#accounttypeuser").val();
        $.ajax({
            method: "GET",
            url: "/Admin/UserData",
            data: { role: role },
            success: function (response) {
                if (response.code == 401) {

                    location.reload();
                }
                else {
                    console.log("Function Success")
                    $('#UserAccessPartial').html(response)

                }

            },
            error: function () {
                console.log("Function Fail")
            }
        })
    }
</script>